properties:
  - name: command
    type: std::string
    init_with: "\"echo hello!\""
  - name: callback
    type: std::function<void(std::string)>
    init_with: "{}"
functions:
  - name: execute
    type: std::string
    body: |
      static const int BUFFER_SIZE = 128;

      std::array<char, BUFFER_SIZE> buffer;
      std::string result;
      std::shared_ptr<FILE> pipe(popen(command.c_str(), "r"), pclose);

      if (!pipe) throw std::runtime_error("ShellCommandExecutor::execute(): Error: popen() failed.");

      while (!feof(pipe.get()))
         if (fgets(buffer.data(), BUFFER_SIZE, pipe.get()) != nullptr)
         {
            result += buffer.data();
            callback(buffer.data());
         }

      return result;
function_body_symbol_dependencies:
  - FILE
  - std::string
  - std::array
  - std::shared_ptr
  - pipe
  - popen
  - pclose
  - feof
  - fgets
  - std::runtime_error
dependencies:
  - symbol: std::function<void(std::string)>
    headers: [ 'functional', 'string' ]
  - symbol: void*
    headers: [ 'string' ]
  - symbol: FILE
    headers: [ 'cstdio' ]
  - symbol: std::string
    headers: [ 'string' ]
  - symbol: std::array
    headers: [ 'array' ]
  - symbol: std::shared_ptr
    headers: [ 'memory' ]
  - symbol: pipe
    headers: [ 'cstdio' ]
  - symbol: popen
    headers: [ 'cstdio' ]
  - symbol: pclose
    headers: [ 'cstdio' ]
  - symbol: feof
    headers: [ 'cstdio' ]
  - symbol: fgets
    headers: [ 'cstdio' ]
  - symbol: std::runtime_error  
    headers: [ 'stdexcept' ]
